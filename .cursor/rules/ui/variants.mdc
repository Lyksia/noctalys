---
id: ui/variants
category: ui
title: Gestion des variantes
status: draft
tags: [variants, cva, clsx, styling]
alwaysApply: false
description: Manage variants with cva, clsx, cn
---

# Gestion des variantes

**Objectif** : Gérer les variantes de composants de manière cohérente avec `cva`, `clsx` et la fonction utilitaire `cn`.

**Contexte** : À appliquer pour assurer la cohérence visuelle et fonctionnelle de l'interface.

## Explication

Les variantes permettent de créer des composants flexibles avec différents états visuels (taille, couleur, style) tout en maintenant un code propre et type-safe.

### Outils utilisés

1. **cva (class-variance-authority)** : Création de variantes typées
2. **clsx** : Composition de classes conditionnelles
3. **cn()** : Fonction utilitaire combinant clsx et tailwind-merge

### La fonction `cn()`

```ts
// src/lib/utils.ts
import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
```

Cette fonction :
- Combine plusieurs classes avec `clsx`
- Résout les conflits Tailwind avec `tailwind-merge`
- Accepte les classes conditionnelles

### Création de variantes avec `cva`

```ts
import { cva, type VariantProps } from "class-variance-authority"

const buttonVariants = cva(
  // Classes de base (toujours appliquées)
  "inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors",
  {
    // Variantes
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline: "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        ghost: "hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    // Variantes par défaut
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

// Extraire le type des variantes
export interface ButtonProps extends VariantProps<typeof buttonVariants> {
  // ... autres props
}
```

### Variantes composées

Pour des combinaisons spécifiques de variantes :

```ts
const alertVariants = cva(
  "relative w-full rounded-lg border p-4",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive: "border-destructive/50 text-destructive dark:border-destructive",
      },
      size: {
        default: "p-4",
        sm: "p-2",
      },
    },
    // Combinaisons spécifiques
    compoundVariants: [
      {
        variant: "destructive",
        size: "sm",
        class: "border-2", // Style appliqué uniquement pour cette combinaison
      },
    ],
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)
```

### Classes conditionnelles avec `cn()`

```ts
interface CardProps {
  isHighlighted?: boolean
  isDisabled?: boolean
  className?: string
}

export const Card = ({ isHighlighted, isDisabled, className }: CardProps) => {
  return (
    <div
      className={cn(
        "rounded-lg border p-4",
        isHighlighted && "border-blue-500 bg-blue-50",
        isDisabled && "opacity-50 pointer-events-none",
        className // Permet de surcharger les styles
      )}
    />
  )
}
```

### Variantes avec états

```ts
const inputVariants = cva(
  "flex h-10 w-full rounded-md border px-3 py-2 text-sm",
  {
    variants: {
      variant: {
        default: "border-input bg-background",
        error: "border-destructive focus-visible:ring-destructive",
      },
      state: {
        default: "",
        disabled: "cursor-not-allowed opacity-50",
        readonly: "cursor-default bg-muted",
      },
    },
    defaultVariants: {
      variant: "default",
      state: "default",
    },
  }
)
```

## Exemple de mise en pratique

```ts
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"

const chipVariants = cva(
  "inline-flex items-center gap-1 rounded-full border px-3 py-1 text-xs font-medium transition-colors",
  {
    variants: {
      variant: {
        default: "border-gray-300 bg-white text-gray-900",
        primary: "border-blue-300 bg-blue-100 text-blue-900",
        success: "border-green-300 bg-green-100 text-green-900",
        warning: "border-yellow-300 bg-yellow-100 text-yellow-900",
        danger: "border-red-300 bg-red-100 text-red-900",
      },
      size: {
        sm: "px-2 py-0.5 text-xs",
        md: "px-3 py-1 text-sm",
        lg: "px-4 py-1.5 text-base",
      },
      clickable: {
        true: "cursor-pointer hover:opacity-80",
        false: "",
      },
    },
    compoundVariants: [
      {
        variant: "primary",
        clickable: true,
        class: "hover:bg-blue-200",
      },
    ],
    defaultVariants: {
      variant: "default",
      size: "md",
      clickable: false,
    },
  }
)

export interface ChipProps
  extends React.HTMLAttributes<HTMLSpanElement>,
    VariantProps<typeof chipVariants> {
  onRemove?: () => void
}

export const Chip = ({
  variant,
  size,
  clickable,
  className,
  children,
  onRemove,
  ...props
}: ChipProps) => {
  return (
    <span
      className={cn(chipVariants({ variant, size, clickable, className }))}
      {...props}
    >
      {children}
      {onRemove && (
        <button
          onClick={onRemove}
          className="ml-1 hover:text-gray-600"
          aria-label="Remove"
        >
          ×
        </button>
      )}
    </span>
  )
}
```

## Variantes ou exceptions

- **Trop de variantes** : Si un composant a plus de 3-4 variantes, envisager de le découper en plusieurs composants.
- **Logique complexe** : Pour des styles très dynamiques, utiliser des styles conditionnels directs plutôt que `cva`.
- **Performance** : `cva` est optimisé mais pour des listes très longues, évaluer l'impact.

## Liens / Références

- [CVA Documentation](https://cva.style/docs)
- [clsx GitHub](https://github.com/lukeed/clsx)
- [tailwind-merge](https://github.com/dcastil/tailwind-merge)
