---
id: utils/numbers
category: utils
title: Helpers pour nombres et montants
status: draft
tags: [utils, numbers, currency, formatting, calculations]
---

# Helpers pour nombres et montants

**Objectif** : Standardiser les helpers de manipulation de nombres et montants pour garantir précision et cohérence.
**Contexte** : À appliquer pour standardiser les helpers et fonctions partagées.

## Explication

Les helpers numériques sont critiques, notamment pour les calculs financiers. Ils doivent gérer la précision, les arrondis et le formatage de manière fiable.

**Fonctions courantes :**

* **formatCurrency** : formater un montant en devise
* **round** : arrondir avec précision configurable
* **clamp** : limiter une valeur entre min et max
* **percentage** : calculer un pourcentage
* **randomInt** : générer un entier aléatoire
* **sum / average** : calculs sur tableaux

**Règles importantes :**

* Montants toujours en **centimes** (entiers) pour éviter les erreurs de précision
* Utiliser `Intl.NumberFormat` pour le formatage
* Gérer les arrondis explicitement
* Valider les entrées (NaN, Infinity)

## Exemple de mise en pratique

```ts
// src/utils/numbers/format-currency.ts

type CurrencyOptions = {
  locale?: string;
  currency?: string;
};

/**
 * Formate un montant en devise
 * @param amountInCents - Montant en centimes
 * @param options - Options de formatage
 * @returns Montant formaté avec symbole
 */
export function formatCurrency(
  amountInCents: number,
  options: CurrencyOptions = {}
): string {
  const { locale = 'fr-FR', currency = 'EUR' } = options;

  return new Intl.NumberFormat(locale, {
    style: 'currency',
    currency,
  }).format(amountInCents / 100);
}

// src/utils/numbers/round.ts

/**
 * Arrondit un nombre avec une précision donnée
 * @param value - Nombre à arrondir
 * @param decimals - Nombre de décimales
 * @returns Nombre arrondi
 */
export function round(value: number, decimals: number = 2): number {
  const multiplier = Math.pow(10, decimals);
  return Math.round(value * multiplier) / multiplier;
}

// src/utils/numbers/clamp.ts

/**
 * Limite une valeur entre min et max
 * @param value - Valeur à limiter
 * @param min - Valeur minimale
 * @param max - Valeur maximale
 * @returns Valeur limitée
 */
export function clamp(value: number, min: number, max: number): number {
  return Math.min(Math.max(value, min), max);
}

// src/utils/numbers/percentage.ts

/**
 * Calcule un pourcentage
 * @param value - Valeur
 * @param total - Total
 * @returns Pourcentage (0-100)
 */
export function percentage(value: number, total: number): number {
  if (total === 0) return 0;
  return round((value / total) * 100, 2);
}

// src/utils/numbers/random-int.ts

/**
 * Génère un entier aléatoire entre min et max (inclus)
 * @param min - Valeur minimale
 * @param max - Valeur maximale
 * @returns Entier aléatoire
 */
export function randomInt(min: number, max: number): number {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

// src/utils/numbers/sum.ts

/**
 * Calcule la somme d'un tableau de nombres
 * @param numbers - Tableau de nombres
 * @returns Somme des nombres
 */
export function sum(numbers: number[]): number {
  return numbers.reduce((acc, n) => acc + n, 0);
}

// src/utils/numbers/average.ts

/**
 * Calcule la moyenne d'un tableau de nombres
 * @param numbers - Tableau de nombres
 * @returns Moyenne des nombres
 */
export function average(numbers: number[]): number {
  if (numbers.length === 0) return 0;
  return sum(numbers) / numbers.length;
}

// src/utils/numbers/format-number.ts

/**
 * Formate un nombre avec séparateurs de milliers
 * @param value - Nombre à formater
 * @param locale - Locale pour le formatage
 * @returns Nombre formaté
 */
export function formatNumber(value: number, locale: string = 'fr-FR'): string {
  return new Intl.NumberFormat(locale).format(value);
}

// src/utils/numbers/index.ts
export { formatCurrency } from './format-currency';
export { round } from './round';
export { clamp } from './clamp';
export { percentage } from './percentage';
export { randomInt } from './random-int';
export { sum } from './sum';
export { average } from './average';
export { formatNumber } from './format-number';
```

## Variantes ou exceptions

* Pour des calculs financiers complexes, utiliser des librairies comme `dinero.js` ou `decimal.js`
* Les calculs scientifiques peuvent nécessiter `math.js`
* Pour des statistiques avancées, utiliser des libs spécialisées

## Liens / Références

* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat
* https://0.30000000000000004.com/
* Documentation interne : `/docs/utils.md`
