---
id: utils/architecture
category: utils
title: Architecture utils et lib
status: draft
tags: [utils, lib, architecture, organization, helpers]
---

# Utils and Lib Architecture

**Objective**: Define a clear separation between `lib/` and `utils/` to ensure consistent organization of helpers and utility functions.
**Context**: To be applied to standardize shared helpers and functions.

## Explanation

The distinction between `lib/` and `utils/` is based on the presence or absence of external dependencies. This separation facilitates maintenance, testing, and code reusability.

**Fundamental difference:**

| Directory | Content                                                  | External dependencies | Examples                                |
| --------- | -------------------------------------------------------- | --------------------- | --------------------------------------- |
| `lib/`    | Functions tied to third-party libraries                  | Yes                   | React Query, Zod, Axios, Prisma         |
| `utils/`  | Pure, reusable functions without third-party dependencies| No                    | Formatting, calculations, transformations|

**Recommended structure:**

```
src/
 ├─ lib/
 │   ├─ react-query/
 │   │   ├─ client.ts           # QueryClient configuration
 │   │   ├─ hooks.ts            # Hooks wrapper
 │   │   └─ index.ts
 │   ├─ zod/
 │   │   ├─ schemas.ts          # Reusable schemas
 │   │   ├─ transforms.ts       # Zod transformations
 │   │   └─ index.ts
 │   └─ axios/
 │       ├─ client.ts           # Configured Axios instance
 │       ├─ interceptors.ts
 │       └─ index.ts
 │
 └─ utils/
     ├─ strings/
     │   ├─ slugify.ts
     │   ├─ capitalize.ts
     │   └─ index.ts
     ├─ dates/
     │   ├─ format-date.ts
     │   ├─ add-days.ts
     │   └─ index.ts
     ├─ numbers/
     │   ├─ format-currency.ts
     │   ├─ round.ts
     │   └─ index.ts
     └─ arrays/
         ├─ group-by.ts
         ├─ unique.ts
         └─ index.ts
```

**Decision rules:**

* **lib/**: if the function imports `react-query`, `zod`, `axios`, `prisma`, etc.
* **utils/**: if the function is pure and without third-party library imports

**Organization principles:**

* **By domain**: group by type of manipulation (strings, dates, arrays)
* **1 function = 1 file**: facilitates navigation and imports
* **Barrels (`index.ts`)**: export all functions from a directory
* **Strict typing**: all functions must be typed
* **Systematic testing**: each function must have its test

**Classification examples:**

```ts
// ✅ lib/ - Depends on Zod
import { z } from 'zod';

export const userSchema = z.object({
  name: z.string(),
  email: z.email(),
});

// ✅ utils/ - Pure function
export function slugify(text: string): string {
  return text.toLowerCase().replace(/\s+/g, '-');
}

// ✅ lib/ - Depends on React Query
import { useQuery } from '@tanstack/react-query';

export function useTypedQuery<T>(key: string[], fn: () => Promise<T>) {
  return useQuery({ queryKey: key, queryFn: fn });
}

// ✅ utils/ - Pure calculation function
export function calculateTax(amount: number, rate: number): number {
  return amount * rate;
}
```

## Practical Implementation Example

```ts
// src/lib/zod/schemas.ts
import { z } from 'zod';

export const emailSchema = z.string().email();
export const passwordSchema = z.string().min(8);

// src/utils/strings/slugify.ts
/**
 * Converts a string to a URL-friendly slug
 * @param text - Text to convert
 * @returns Lowercase slug with hyphens
 */
export function slugify(text: string): string {
  return text
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/^-+|-+$/g, '');
}

// src/lib/react-query/client.ts
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000,
      refetchOnWindowFocus: false,
    },
  },
});

// src/utils/dates/format-date.ts
/**
 * Formats a date in French
 * @param date - Date to format
 * @returns Formatted date (e.g., "27 octobre 2025")
 */
export function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('fr-FR', {
    day: 'numeric',
    month: 'long',
    year: 'numeric',
  }).format(date);
}

// Usage via barrels
// src/lib/index.ts
export * from './react-query';
export * from './zod';
export * from './axios';

// src/utils/index.ts
export * from './strings';
export * from './dates';
export * from './numbers';

// Import in code
import { slugify, formatDate } from '@/utils';
import { queryClient, emailSchema } from '@/lib';
```

## Variants or Exceptions

* Feature-specific helpers remain in `features/[feature]/utils/`
* Functions requiring both dependencies and pure logic can be separated into two files
* For very simple projects without complex libraries, a single `utils/` directory may suffice

## Links / References

* Internal documentation: `/docs/architecture.md`
* Internal documentation: `/docs/code-organization.md`
