---
id: utils/lib
category: utils
title: Helpers dépendants de librairies
status: draft
tags: [utils, lib, helpers, dependencies, wrappers]
---

# Library-Dependent Helpers

**Objective**: Document library-dependent helpers to centralize configurations and wrappers.
**Context**: To be applied to standardize shared helpers and functions.

## Explanation

The `lib/` directory contains all helpers that depend on third-party libraries. These functions serve as an abstraction and configuration layer to standardize the use of external tools in the project.

**Role of the `lib/` directory:**

* Centralize library configuration
* Create typed and reusable wrappers
* Facilitate migrations (library changes)
* Ensure consistent usage throughout the project

**Common libraries in `lib/`:**

* **react-query/**: QueryClient configuration, custom hooks
* **zod/**: Reusable schemas, transformations
* **axios/**: Configured instance, interceptors
* **prisma/**: Client extensions, query helpers
* **nodemailer/**: SMTP configuration, templates
* **stripe/**: Client configuration, payment helpers

**Typical structure:**

```
src/lib/
 ├─ react-query/
 │   ├─ client.ts           # Configured QueryClient
 │   ├─ hooks.ts            # Typed wrapper hooks
 │   ├─ utils.ts            # Helpers (invalidation, etc.)
 │   └─ index.ts
 ├─ zod/
 │   ├─ schemas.ts          # Global schemas
 │   ├─ transforms.ts       # Custom transformations
 │   ├─ validators.ts       # Reusable validators
 │   └─ index.ts
 ├─ axios/
 │   ├─ client.ts           # Axios instance
 │   ├─ interceptors.ts     # Auth, errors, etc.
 │   └─ index.ts
 └─ index.ts                # Global barrel
```

**Best practices:**

* Type all functions and configurations
* Document options and configurations
* Test wrappers and transformations
* Export via barrels to simplify imports
* Version configurations (migration comments)

**Mistakes to avoid:**

* Importing libraries directly without going through `lib/`
* Duplicating configurations across multiple files
* Creating overly abstract wrappers that hide the original API
* Mixing business logic and library configuration

## Practical Implementation Example

```ts
// src/lib/react-query/client.ts
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000,
      gcTime: 10 * 60 * 1000,
      refetchOnWindowFocus: false,
      retry: 3,
    },
    mutations: {
      retry: 1,
    },
  },
});

// src/lib/react-query/hooks.ts
import { useQuery, useMutation, UseQueryOptions } from '@tanstack/react-query';
import type { ZodSchema } from 'zod';

/**
 * React Query hook with automatic Zod validation
 */
export function useValidatedQuery<TData, TSchema>(
  queryKey: string[],
  queryFn: () => Promise<unknown>,
  schema: ZodSchema<TSchema>,
  options?: UseQueryOptions<TData>
) {
  return useQuery({
    queryKey,
    queryFn: async () => {
      const data = await queryFn();
      return schema.parse(data);
    },
    ...options,
  });
}

// src/lib/zod/schemas.ts
import { z } from 'zod';

export const emailSchema = z
  .string()
  .email('Invalid email')
  .toLowerCase()
  .trim();

export const passwordSchema = z
  .string()
  .min(8, 'Minimum 8 characters')
  .regex(/[A-Z]/, 'At least one uppercase letter')
  .regex(/[0-9]/, 'At least one digit');

export const dateStringSchema = z
  .string()
  .datetime()
  .transform((str) => new Date(str));

// src/lib/zod/validators.ts
import { z } from 'zod';

/**
 * Custom validator for slugs
 */
export const slugValidator = z
  .string()
  .regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/, 'Invalid slug');

/**
 * Validator for amounts in cents
 */
export const amountValidator = z
  .number()
  .int('Must be an integer')
  .positive('Must be positive');

// src/lib/axios/client.ts
import axios from 'axios';

export const apiClient = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL || '/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// src/lib/axios/interceptors.ts
import { apiClient } from './client';

// Interceptor to add authentication token
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('auth_token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Interceptor to handle errors
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // Redirect to login
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

// src/lib/stripe/client.ts
import { loadStripe } from '@stripe/stripe-js';

export const stripePromise = loadStripe(
  process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!
);

// src/lib/index.ts (global barrel)
export * from './react-query';
export * from './zod';
export * from './axios';
export * from './stripe';

// Usage in code
import { queryClient, useValidatedQuery } from '@/lib/react-query';
import { emailSchema, passwordSchema } from '@/lib/zod';
import { apiClient } from '@/lib/axios';
```

## Variants or Exceptions

* For feature-specific libraries, place them in `features/[feature]/lib/`
* Environment configurations can be isolated in `config/`
* For projects without necessary abstraction, import libraries directly (not recommended)

## Links / References

* https://tanstack.com/query/latest
* https://zod.dev/
* https://axios-http.com/
* Internal documentation: `/docs/libraries.md`
