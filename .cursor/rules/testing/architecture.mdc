---
id: testing/architecture
category: testing
title: Test Architecture
status: draft
tags: [testing, architecture, organization, strategy]
---

# Test Architecture

**Objective**: Define the hierarchy and role of tests in the project to ensure consistent and maintainable coverage.
**Context**: To be applied to ensure code quality and reliability.

## Explanation

Test architecture is based on a pyramidal approach: a solid foundation of unit tests, a layer of integration tests, and targeted end-to-end tests. Each type of test has a specific and complementary role.

**Test Hierarchy:**

1. **Unit tests** (70-80%): test isolated functions, hooks, or components
2. **Integration tests** (15-25%): test the interaction between multiple modules
3. **End-to-end tests** (5-10%): test complete user journeys

**File Organization:**

```
src/
 ├─ features/
 │   └─ calendar/
 │       ├─ components/
 │       │   ├─ event-card.tsx
 │       │   └─ event-card.test.tsx
 │       ├─ hooks/
 │       │   ├─ use-calendar.ts
 │       │   └─ use-calendar.test.ts
 │       └─ services/
 │           ├─ calendar.service.ts
 │           └─ calendar.service.test.ts
 └─ test/
     ├─ utils/
     │   └─ mocks/
     ├─ setup.ts
     └─ README.md
```

**Guiding Principles:**

* 1 test file per component, hook, or service
* `.test.tsx` extension for components, `.test.ts` for everything else
* Tests co-located with the tested code
* Centralized mocks in `test/utils/mocks/`
* Global configuration in `test/setup.ts`

**Test Roles:**

* **Unit**: validate business logic, data transformations, calculations
* **Integration**: verify that modules work together (e.g., hook + service + component)
* **E2E**: ensure critical flows work (authentication, payment, etc.)

**Golden Rules:**

* Prioritize behavior over implementation
* Fast and deterministic tests
* Complete isolation (no external dependencies)
* Minimum 80% coverage
* No overuse of mocks in integration tests

## Practical Implementation Example

```ts
// Unit test: src/utils/dates/format-date.test.ts
import { describe, it, expect } from 'vitest';
import { formatDate } from './format-date';

describe('formatDate', () => {
  it('should format date in French locale', () => {
    const date = new Date('2025-10-27');
    expect(formatDate(date)).toBe('27 octobre 2025');
  });
});

// Integration test: src/features/calendar/components/calendar-view.test.tsx
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { CalendarView } from './calendar-view';

describe('CalendarView integration', () => {
  it('should fetch and display events', async () => {
    const queryClient = new QueryClient();
    render(
      <QueryClientProvider client={queryClient}>
        <CalendarView />
      </QueryClientProvider>
    );

    expect(await screen.findByText('Réunion d\'équipe')).toBeInTheDocument();
  });
});
```

## Variants or Exceptions

* Projects without an interface can focus solely on unit and integration tests
* For critical projects (payment, healthcare), increase the proportion of E2E tests
* POCs and prototypes may temporarily have reduced coverage

## Links / References

* https://martinfowler.com/articles/practical-test-pyramid.html
* https://kentcdodds.com/blog/write-tests
* Internal documentation: `/test/README.md`
