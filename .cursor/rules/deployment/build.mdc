---
id: deployment/build
category: deployment
title: Build
status: draft
tags: [build, nextjs, compilation, optimization]
---

# Build

**Objective**: Document the Next.js build command and its prerequisites to ensure successful deployment.
**Context**: To be applied for deployment and continuous integration stages.

## Explanation

The build command compiles the Next.js application for production. It:
- Compiles TypeScript code to JavaScript.
- Optimizes bundles (tree-shaking, minification).
- Generates static pages (SSG).
- Prepares API routes and Server Components.
- Optimizes images and assets.

**Prerequisites before build:**
- All required environment variables must be defined.
- No TypeScript errors must be present.
- No blocking ESLint warnings.
- Dependencies must be installed (`node_modules` up to date).

**Key commands:**

```bash
npm run build        # Production build
npm run start        # Starts production server (after build)
npm run build:check  # Build + checks (optional)
```

## Practical Implementation Example

**package.json :**

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit",
    "build:check": "npm run type-check && npm run lint && npm run build"
  }
}
```

**Next.js configuration (next.config.js):**

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  swcMinify: true,

  // Image optimization
  images: {
    domains: ['example.com'],
    formats: ['image/avif', 'image/webp'],
  },

  // Public environment variables
  env: {
    CUSTOM_KEY: process.env.CUSTOM_KEY,
  },

  // Output standalone for Docker (optional)
  output: 'standalone',

  // Redirects and rewrites
  async redirects() {
    return [];
  },

  async rewrites() {
    return [];
  },
};

module.exports = nextConfig;
```

**Local build verification:**

```bash
# 1. Install dependencies
npm ci

# 2. Check typing
npm run type-check

# 3. Check linting
npm run lint

# 4. Run the build
npm run build

# 5. Test the build locally
npm run start
# → Opens http://localhost:3000
```

**Build output:**

```
Route (app)                              Size     First Load JS
┌ ○ /                                    5.2 kB         87.3 kB
├ ○ /about                               4.8 kB         86.9 kB
├ ƒ /api/users                           0 B            0 B
└ ○ /dashboard                           12.3 kB        94.4 kB

○ (Static)   prerendered as static content
ƒ (Dynamic)  server-rendered on demand
```

**Vercel configuration:**

```json
{
  "buildCommand": "npm run build",
  "devCommand": "npm run dev",
  "installCommand": "npm ci",
  "framework": "nextjs",
  "outputDirectory": ".next"
}
```

## Variants or Exceptions

- **Build without lint**: Disable ESLint during build (not recommended):
  ```js
  // next.config.js
  module.exports = {
    eslint: {
      ignoreDuringBuilds: true, // ⚠️ Not recommended
    },
  };
  ```

- **Incremental build**: Next.js automatically caches builds (`.next/cache`).

- **Output standalone**: For Docker or custom server deployment:
  ```js
  module.exports = {
    output: 'standalone',
  };
  ```

- **Bundle analysis**: Add `@next/bundle-analyzer`:
  ```bash
  npm install @next/bundle-analyzer
  ANALYZE=true npm run build
  ```

- **Build timeout**: Increase timeout on Vercel (max 45 min on Enterprise).

- **Missing variables**: Build will fail if required variables are not defined.

## Links / References

- [Next.js Building for Production](https://nextjs.org/docs/deployment)
- [Next.js Configuration](https://nextjs.org/docs/api-reference/next.config.js/introduction)
- [Vercel Build Configuration](https://vercel.com/docs/concepts/projects/overview#build-configuration)
- Internal documentation: `.cursor/docs/references.md`
