---
id: deployment/monitoring
category: deployment
title: Monitoring (optionnel)
status: draft
tags: [monitoring, logs, observability, sentry, analytics]
---

# Monitoring (optionnel)

**Objectif** : Suivre les logs, erreurs et performances de l'application apr√®s d√©ploiement.
**Contexte** : √Ä appliquer pour les √©tapes de d√©ploiement et int√©gration continue.

## Explication

Le monitoring permet de d√©tecter et diagnostiquer les probl√®mes en production :
- **Erreurs runtime** : Exceptions JavaScript, erreurs API.
- **Performance** : Temps de chargement, Core Web Vitals.
- **Usage** : Analytics, pages vues, conversions.
- **Infrastructure** : Disponibilit√©, latence, timeouts.

**Outils recommand√©s :**

| Outil           | Usage                          | Int√©gration                     |
| --------------- | ------------------------------ | ------------------------------- |
| Vercel Logs     | Logs de build et runtime       | Natif (dashboard + CLI)         |
| Sentry          | Error tracking et performance  | SDK Next.js                     |
| Vercel Analytics| Core Web Vitals et performance | Natif (dashboard)               |
| PostHog         | Analytics produit et A/B tests | SDK JavaScript                  |
| LogRocket       | Session replay et debugging    | SDK JavaScript                  |
| Axiom           | Log aggregation et search      | Integration Vercel              |

**Niveaux de monitoring :**
1. **Basique** : Vercel Logs + Vercel Analytics (gratuit).
2. **Interm√©diaire** : + Sentry pour error tracking.
3. **Avanc√©** : + PostHog/LogRocket pour analytics et replay.

## Exemple de mise en pratique

**Configuration Sentry :**

```bash
npm install @sentry/nextjs
npx @sentry/wizard@latest -i nextjs
```

**sentry.client.config.ts :**

```ts
import * as Sentry from '@sentry/nextjs';

Sentry.init({
  dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
  environment: process.env.VERCEL_ENV || 'development',
  
  // Performance monitoring
  tracesSampleRate: 1.0,
  
  // Session replay
  replaysSessionSampleRate: 0.1,
  replaysOnErrorSampleRate: 1.0,
  
  integrations: [
    new Sentry.BrowserTracing(),
    new Sentry.Replay(),
  ],
});
```

**sentry.server.config.ts :**

```ts
import * as Sentry from '@sentry/nextjs';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.VERCEL_ENV || 'development',
  tracesSampleRate: 1.0,
});
```

**Vercel Analytics :**

```tsx
// app/layout.tsx
import { Analytics } from '@vercel/analytics/react';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        {children}
        <Analytics />
      </body>
    </html>
  );
}
```

**PostHog Analytics :**

```tsx
// app/providers.tsx
'use client';

import posthog from 'posthog-js';
import { PostHogProvider } from 'posthog-js/react';
import { useEffect } from 'react';

export function Providers({ children }: { children: React.ReactNode }) {
  useEffect(() => {
    posthog.init(process.env.NEXT_PUBLIC_POSTHOG_KEY!, {
      api_host: process.env.NEXT_PUBLIC_POSTHOG_HOST,
      capture_pageview: false, // Next.js g√®re d√©j√† la navigation
    });
  }, []);
  
  return <PostHogProvider client={posthog}>{children}</PostHogProvider>;
}
```

**Logs custom avec pino :**

```ts
// lib/logger.ts
import pino from 'pino';

export const logger = pino({
  level: process.env.LOG_LEVEL || 'info',
  transport: {
    target: 'pino-pretty',
    options: {
      colorize: true,
    },
  },
});

// Usage
logger.info({ userId: 123 }, 'User logged in');
logger.error({ error: err }, 'Payment failed');
```

**Health check avec monitoring :**

```ts
// app/api/health/route.ts
import { logger } from '@/lib/logger';

export async function GET() {
  const checks = {
    database: await checkDatabase(),
    redis: await checkRedis(),
    stripe: await checkStripe(),
  };
  
  const status = Object.values(checks).every(Boolean) ? 'healthy' : 'degraded';
  
  logger.info({ checks, status }, 'Health check performed');
  
  return Response.json({ status, checks });
}
```

**Dashboard custom avec Axiom :**

```bash
# Installation
npm install @axiomhq/vercel

# Configuration via Vercel Integration
# ‚Üí Dashboard Vercel ‚Üí Integrations ‚Üí Axiom
```

**Alertes Slack en cas d'erreur :**

```ts
// lib/alerts.ts
export async function sendAlert(error: Error, context: Record<string, any>) {
  if (process.env.NODE_ENV !== 'production') return;
  
  await fetch(process.env.SLACK_WEBHOOK_URL!, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      text: `üö® Error in production: ${error.message}`,
      blocks: [
        {
          type: 'section',
          text: {
            type: 'mrkdwn',
            text: `*Error:* ${error.message}\n*Context:* ${JSON.stringify(context)}`,
          },
        },
      ],
    }),
  });
}
```

## Variantes ou exceptions

- **Monitoring l√©ger** : Utiliser uniquement Vercel Logs + Analytics (gratuit).
- **Multi-cloud** : Utiliser Datadog ou New Relic pour centraliser.
- **Custom metrics** : Envoyer des m√©triques business vers InfluxDB/Prometheus.
- **Uptime monitoring** : Ajouter Uptime Robot ou Pingdom pour v√©rifier la disponibilit√©.
- **Cost monitoring** : Surveiller les co√ªts Vercel/Stripe via webhooks.

## Liens / R√©f√©rences

- [Sentry for Next.js](https://docs.sentry.io/platforms/javascript/guides/nextjs/)
- [Vercel Analytics](https://vercel.com/docs/analytics)
- [PostHog Documentation](https://posthog.com/docs)
- [Axiom + Vercel](https://axiom.co/docs/integrations/vercel)
- [LogRocket for Next.js](https://docs.logrocket.com/docs/nextjs)
- Documentation interne : `.cursor/docs/references.md`
