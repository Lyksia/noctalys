---
id: deployment/env-variables
category: deployment
title: Environment Variables
status: draft
tags: [env, variables, configuration, security]
---

# Environment Variables

**Objective**: Manage environment variables securely and consistently between local and deployment.
**Context**: To be applied for deployment and continuous integration stages.

## Explanation

Environment variables allow configuring the application without hardcoding sensitive values.

**Fundamental rules:**
- Never put secrets in source code.
- Never commit `.env.local`, `.env.production`, etc.
- Always provide a versioned `.env.example`.
- Prefix public variables with `NEXT_PUBLIC_`.
- Validate variables at application startup.

**Types of variables:**
- **Public** (`NEXT_PUBLIC_*`): Exposed to the client (API URL, Stripe public keys).
- **Private**: Accessible only server-side (API secrets, tokens, encryption keys).

**Where to define them:**
- **Local**: `.env.local`
- **Vercel**: Dashboard → Environment Variables
- **CI**: GitHub Secrets → Environment Variables in the workflow

## Practical Implementation Example

**.env.example (versioned in Git):**

```bash
# Public variables (exposed to browser)
NEXT_PUBLIC_API_URL="http://localhost:3000/api"
NEXT_PUBLIC_APP_URL="http://localhost:3000"
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY="pk_test_..."

# Private variables (server-only)
DATABASE_URL="postgresql://user:password@localhost:5432/db"
STRIPE_SECRET_KEY="sk_test_..."
STRIPE_WEBHOOK_SECRET="whsec_..."
SMTP_HOST="smtp.example.com"
SMTP_PORT="587"
SMTP_USER="user@example.com"
SMTP_PASSWORD="password"
EMAIL_FROM="noreply@example.com"
JWT_SECRET="your-jwt-secret-key"
```

**.gitignore (required):**

```
.env.local
.env.*.local
.env.development.local
.env.test.local
.env.production.local
```

**Variable validation with Zod:**

```ts
import { z } from 'zod';

const envSchema = z.object({
  // Public
  NEXT_PUBLIC_API_URL: z.string().url(),
  NEXT_PUBLIC_APP_URL: z.string().url(),
  NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: z.string().startsWith('pk_'),
  
  // Private
  DATABASE_URL: z.string().url(),
  STRIPE_SECRET_KEY: z.string().startsWith('sk_'),
  STRIPE_WEBHOOK_SECRET: z.string().startsWith('whsec_'),
  SMTP_HOST: z.string(),
  SMTP_PORT: z.string(),
  SMTP_USER: z.string().email(),
  SMTP_PASSWORD: z.string(),
  EMAIL_FROM: z.string().email(),
  JWT_SECRET: z.string().min(32),
});

export const env = envSchema.parse(process.env);
```

**Usage in code:**

```ts
// ✅ Correct - validated variable
import { env } from '@/config/env';

const apiUrl = env.NEXT_PUBLIC_API_URL;
const stripeKey = env.STRIPE_SECRET_KEY;

// ❌ Avoid - direct access without validation
const apiUrl = process.env.NEXT_PUBLIC_API_URL;
```

**Vercel configuration:**

```
Dashboard → Project → Settings → Environment Variables

Production:
  STRIPE_SECRET_KEY = sk_live_xxx (Sensitive)
  DATABASE_URL = postgresql://prod... (Sensitive)
  
Preview:
  STRIPE_SECRET_KEY = sk_test_xxx
  DATABASE_URL = postgresql://preview...
  
Development:
  STRIPE_SECRET_KEY = sk_test_xxx
  DATABASE_URL = postgresql://dev...
```

## Variants or Exceptions

- **Rotating secrets**: Use Vercel CLI or API to update secrets automatically.
- **Multi-tenancy**: Use variables with prefixes per tenant.
- **Feature flags**: Store in env variables or use a dedicated service (LaunchDarkly).
- **Optional variables**: Mark them as `.optional()` in the Zod schema.

## Links / References

- [Next.js Environment Variables](https://nextjs.org/docs/basic-features/environment-variables)
- [Vercel Environment Variables](https://vercel.com/docs/concepts/projects/environment-variables)
- [Zod Documentation](https://zod.dev)
- Internal documentation: `.cursor/docs/references.md`
