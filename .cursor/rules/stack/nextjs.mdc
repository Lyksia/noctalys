---
alwaysApply: false
description: Conventions for using Next.js (App Router, Server Components, API Routes)
---

# Next.js

**Objective**: Standardize Next.js usage in projects by adopting the App Router, Server Components, and recommended best practices.

**Context**: To apply for standardizing the use of this technology in projects.

## Explanation

Next.js is the React framework used for all projects. Prioritize the **App Router** (rather than the Pages Router) and leverage **Server Components** by default.

**Key Principles:**

- **App Router**: all routing logic lives in `app/`.
- **Server Components by default**: components are server-side unless marked with `"use client"`.
- **API Routes**: use Route Handlers (`route.ts`) in `app/api/`.
- **Layouts**: centralize shared layouts in `app/layout.tsx`.
- **Metadata**: define SEO metadata via `metadata` or `generateMetadata`.
- **Loading & Error states**: use `loading.tsx` and `error.tsx` to handle states.

**App Router Structure:**

```
app/
 ├─ layout.tsx           # Layout racine
 ├─ page.tsx             # Page d'accueil
 ├─ loading.tsx          # Loading state global
 ├─ error.tsx            # Error boundary global
 ├─ not-found.tsx        # Page 404
 ├─ api/                 # API Routes
 │   └─ users/
 │       └─ route.ts
 └─ dashboard/
     ├─ layout.tsx       # Layout dashboard
     ├─ page.tsx         # Page dashboard
     └─ settings/
         └─ page.tsx
```

**Rules:**

- Use Server Components by default.
- Mark `"use client"` only when necessary (hooks, events, state).
- Avoid passing non-serializable functions or classes to Server Components.
- Use `async/await` directly in Server Components for fetching.

## Practical Implementation Example

**Server Component (default):**

```ts
// app/dashboard/page.tsx
import { fetchUsers } from "@/features/users/services";

export default async function DashboardPage() {
  const users = await fetchUsers();

  return (
    <div>
      <h1>Dashboard</h1>
      <UserList users={users} />
    </div>
  );
}
```

**Client Component (with "use client"):**

```ts
// src/features/users/components/user-form.tsx
"use client";

import { useState } from "react";

export function UserForm() {
  const [name, setName] = useState("");

  return (
    <form>
      <input value={name} onChange={(e) => setName(e.target.value)} />
    </form>
  );
}
```

**API Route :**

```ts
// app/api/users/route.ts
import { NextResponse } from "next/server";

export async function GET() {
  const users = await fetchUsersFromDB();
  return NextResponse.json(users);
}

export async function POST(request: Request) {
  const body = await request.json();
  const user = await createUser(body);
  return NextResponse.json(user, { status: 201 });
}
```

**Metadata :**

```ts
// app/dashboard/page.tsx
import type { Metadata } from "next";

export const metadata: Metadata = {
  title: "Dashboard | Lyksia",
  description: "Manage your account and settings",
};

export default function DashboardPage() {
  return <div>Dashboard</div>;
}
```

## Variants or Exceptions

- Use the Pages Router only for existing projects that haven't migrated.
- Projects with lots of interactivity can favor Client Components, but must remain consistent.

## Links / References

- [Next.js App Router Documentation](https://nextjs.org/docs/app)
- [Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components)
- [Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)
