---
alwaysApply: false
description: Real-time management and lightweight data
---

# SWR

**Objective**: Standardize SWR usage for real-time data management and lightweight data with polling.

**Context**: To apply for standardizing the use of this technology in projects.

## Explanation

SWR is used for **lightweight**, **volatile**, and **real-time** data that requires frequent polling or rapid synchronization. For persistent data and advanced caching, prefer React Query.

**When to use SWR:**

- Real-time data (statuses, notifications, presence)
- Frequent polling (< 30 seconds)
- Volatile data that changes often
- Cross-tab synchronization

**When to use React Query:**

- Persistent data
- Advanced caching
- Complex mutations
- Pagination and infinite scroll

**Installation :**

```bash
npm install swr
```

## Practical Implementation Example

**Basic usage:**

```ts
// src/features/notifications/hooks/use-notifications.ts
import useSWR from "swr";
import { fetchNotifications } from "../services";

export function useNotifications() {
  return useSWR("/api/notifications", fetchNotifications, {
    refreshInterval: 10000, // Polling every 10 seconds
    revalidateOnFocus: true,
  });
}
```

**Fetcher global :**

```ts
// src/lib/swr.ts
export async function fetcher<T>(url: string): Promise<T> {
  const response = await fetch(url);
  if (!response.ok) {
    throw new Error("Failed to fetch");
  }
  return response.json();
}
```

**Provider avec configuration :**

```tsx
// app/layout.tsx
"use client";

import { SWRConfig } from "swr";
import { fetcher } from "@/lib/swr";

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <SWRConfig
          value={{
            fetcher,
            revalidateOnFocus: false,
            shouldRetryOnError: false,
          }}
        >
          {children}
        </SWRConfig>
      </body>
    </html>
  );
}
```

**Real-time with polling:**

```ts
// src/features/presence/hooks/use-online-users.ts
import useSWR from "swr";
import { fetchOnlineUsers } from "../services";

export function useOnlineUsers() {
  return useSWR("/api/users/online", fetchOnlineUsers, {
    refreshInterval: 5000, // Polling every 5 seconds
    dedupingInterval: 2000, // Avoid duplicate requests
  });
}
```

**Mutation avec SWR :**

```ts
// src/features/notifications/hooks/use-mark-as-read.ts
import useSWR, { useSWRConfig } from "swr";
import { markNotificationAsRead } from "../services";

export function useMarkAsRead() {
  const { mutate } = useSWRConfig();

  const markAsRead = async (notificationId: string) => {
    // Optimistic update
    mutate(
      "/api/notifications",
      (current) =>
        current?.map((n) =>
          n.id === notificationId ? { ...n, read: true } : n
        ),
      false
    );

    // API call
    await markNotificationAsRead(notificationId);

    // Revalidation
    mutate("/api/notifications");
  };

  return { markAsRead };
}
```

**Conditional data:**

```ts
// src/features/chat/hooks/use-messages.ts
import useSWR from "swr";
import { fetchMessages } from "../services";

export function useMessages(chatId: string | null) {
  return useSWR(
    chatId ? `/api/chats/${chatId}/messages` : null, // Only fetch if chatId exists
    () => fetchMessages(chatId!),
    {
      refreshInterval: 3000,
    }
  );
}
```

## Variants or Exceptions

- Persistent data with advanced caching should use React Query.
- Projects without real-time needs can do without SWR.

## Links / References

- [SWR Documentation](https://swr.vercel.app/)
- [SWR vs React Query](https://swr.vercel.app/docs/comparison)
- [Polling with SWR](https://swr.vercel.app/docs/revalidation)
